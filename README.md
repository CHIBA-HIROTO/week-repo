# Urban Farming Dashboard (環境モニタリング & 収量シミュレーション)

施設園芸（ハウス栽培）向けの環境データ可視化・生育分析・収量予測アプリケーションです。
UECS環境データと生育調査データを統合し、データ駆動型の栽培管理を支援します。

## 🚀 主な機能

1.  **環境モニタリング**: ハウス内の気温、湿度、CO2、日射量、飽差(VPD)などをグラフで可視化。
2.  **生育状況の記録**: 生育調査データ（葉数、花数、果実数など）を時系列で確認。
3.  **収量予測シミュレーション**: 過去の気象データと実測値を組み合わせて、定植日から現在までの積算収量を予測。
4.  **認証システム**: 農家ごとの個別ログインと、パスワード変更機能。

---

## 📖 使い方ガイド

### 1. ログイン (Login)
アプリ起動時、ログイン画面が表示されます。
*   **Farm ID**: プルダウンから農場IDを選択してください。
*   **Password**: パスワードを入力して `Login` ボタンを押してください。
    *   初期パスワードは管理者から配布されます。
*   **開発者用マスターアクセス**:
    *   開発者はマスターパスワード (`devpass999` ※デフォルト設定) を使用することで、どのIDでもログイン可能です。

### 2. パスワードの変更
ログイン後、画面右上の「⚙️ Settings」パネルからパスワードを変更できます。
1.  **Change Password** セクションを展開します。
2.  `Current Password`（現在のパスワード）を入力します。
3.  `New Password`（新しいパスワード）を2回入力します。
4.  `Update Password` を押すと変更が保存されます。
    *   ※マスターログイン中はパスワード変更機能は使用できません。

### 3. 環境モニタリング (Environmental Monitoring)
*   **Display Mode**:
    *   `Latest Week`: 直近1週間のデータを表示します。
    *   `Select Week`: 過去のデータファイル単位で期間を選択できます。
    *   `Custom Range`: スライダーで自由に期間を指定できます。
*   **Metrics**: 表示したい項目（気温、日射、VPDなど）を複数選択できます。

### 4. 収量予測シミュレーション (Yield Prediction Simulation)
画面下部の **Review & Yield Prediction** セクションで使用します。
「過去の気象データ(Open-Meteo)」と「実測データ」を組み合わせて、より現実に近い収量を計算します。

1.  **パラメータ設定 (画面左側)**:
    *   植栽密度、光利用効率、分配率などを調整できます。
2.  **シミュレーション実行 (画面右側)**:
    *   **Planting Date (定植日)**: 計算の開始日を設定します。
    *   **Location**: 画面上部「Settings」の緯度経度設定が反映されます。
    *   **Temp Offset / Transmissivity**: センサデータがない期間（過去）について、外気温からの昇温と、ハウス透過率を設定して環境を推定します。
    *   `Run Simulation` ボタンを押すと、積算温度(GDD)と予測収量の推移グラフが表示されます。

---

## 🛠 インストールと起動方法

### 必要要件
*   Python 3.10+
*   推奨ブラウザ: Chrome, Edge, Safari

### セットアップ
```bash
# リポジトリのクローン
git clone <repository_url>
cd week_repo

# 仮想環境の作成と有効化 (推奨)
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# .venv\Scripts\activate   # Windows

# 依存ライブラリのインストール
pip install -r requirements.txt
```

### アプリの起動
```bash
streamlit run app.py
```
ブラウザが自動的に開き、アプリが表示されます（デフォルト: `http://localhost:8501`）。

---

## 📁 データ構造
データは `data/` ディレクトリ配下に農家ごとにフォルダ分けして保存します。
*   `data/farm_a/uecs/`: 環境データCSV (自動読み込み対応)
*   `data/farm_a/growth/`: 生育調査データCSV
